!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-dispatch"),require("d3-transition"),require("d3-timer"),require("d3-interpolate"),require("d3-zoom"),require("@hpcc-js/wasm"),require("d3-format"),require("d3-path")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-dispatch","d3-transition","d3-timer","d3-interpolate","d3-zoom","@hpcc-js/wasm","d3-format","d3-path"],e):e((t=t||self)["d3-graphviz"]={},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t["@hpcc-js/wasm"],t.d3,t.d3)}(this,(function(t,e,n,i,a,r,o,s,l,h){"use strict";function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(t){var e={},n=t.node().nodeName;e.tag=n,"#text"==n?e.text=t.text():"#comment"==n&&(e.comment=t.text()),e.attributes={};var i=t.node().attributes;if(i)for(var a=0;a<i.length;a++){var r=i[a],o=r.name,s=r.value;e.attributes[o]=s}var l=t.node().transform;if(l&&0!=l.baseVal.numberOfItems){var h=l.baseVal.consolidate().matrix;e.translation={x:h.e,y:h.f},e.scale=h.a}if("ellipse"==n&&(e.center={x:e.attributes.cx,y:e.attributes.cy}),"polygon"==n){var c=(g=t.attr("points").split(" ")).map((function(t){return t.split(",")[0]})),d=g.map((function(t){return t.split(",")[1]})),u=Math.min.apply(null,c),f=Math.max.apply(null,c),p={x:u,y:v=Math.min.apply(null,d),width:f-u,height:(m=Math.max.apply(null,d))-v};e.bbox=p,e.center={x:(u+f)/2,y:(v+m)/2}}if("path"==n){var g;(g=t.attr("d").split(/[A-Z ]/)).shift();var v,m;c=g.map((function(t){return+t.split(",")[0]})),d=g.map((function(t){return+t.split(",")[1]})),u=Math.min.apply(null,c),f=Math.max.apply(null,c),p={x:u,y:v=Math.min.apply(null,d),width:f-u,height:(m=Math.max.apply(null,d))-v};e.bbox=p,e.center={x:(u+f)/2,y:(v+m)/2},e.totalLength=t.node().getTotalLength()}return"text"==n&&(e.center={x:t.attr("x"),y:t.attr("y")}),"#text"==n?e.text=t.text():"#comment"==n&&(e.comment=t.text()),e}function f(t){var n=u(t);return n.children=[],e.selectAll(t.node().childNodes).each((function(){var t=f(e.select(this));t.parent=n,n.children.push(t)})),n}function p(t){return"#text"==t.tag?document.createTextNode(""):"#comment"==t.tag?document.createComment(t.comment):document.createElementNS("http://www.w3.org/2000/svg",t.tag)}function g(t){for(var n=p(t),i=e.select(n),a=t.attributes,r=0,o=Object.keys(a);r<o.length;r++){var s=o[r],l=a[s];i.attr(s,l)}return n}function v(t,n){var i=e.select(t.node().parentNode),a=g(n),r=i.insert((function(){return a}),(function(){return t.node()}));return t.remove(),r}function m(t,n){!function(t,e){t.datum(e),t.data([e],(function(t){return t.key}))}(t,n),e.selectAll(t.node().childNodes).each((function(t,i){m(e.select(this),n.children[i])}))}function y(t,e){var n=t.selectAll((function(){return t.node().childNodes})),i=(n=n.data((function(t){return t.children}),(function(t){return t.tag+"-"+e}))).enter().append((function(t){return p(t)})),a=n.exit();a=a.remove(),n=i.merge(n);var r={};n.each((function(t){var e=t.tag;null==r[e]&&(r[e]=0);var n=r[e]++;_.call(this,t,n)}))}function _(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.select(this),a=(t.tag,t.attributes),r=i.node().attributes;if(r)for(var o=0;o<r.length;o++){var s=r[o],l=s.name;if("xmlns"!=l.split(":")[0]&&s.namespaceURI){var h=s.namespaceURI.split("/"),c=h[h.length-1];l=c+":"+l}l in a||(a[l]=null)}for(var d=0,u=Object.keys(a);d<u.length;d++){var f=u[d];i.attr(f,a[f])}t.text&&i.text(t.text),y(i,n)}function w(t){return Object.assign({},t)}function x(t){return Math.round(100*t)/100}function b(){var t=this._selection,n=e.select(t.node().querySelector("svg"));if(0==n.size())return this;this._zoomSelection=n;var i=o.zoom().scaleExtent(this._options.zoomScaleExtent).translateExtent(this._options.zoomTranslateExtent).interpolate(r.interpolate).on("zoom",(function(){e.select(n.node().querySelector("g")).attr("transform",e.event.transform)}));this._zoomBehavior=i;var a=e.select(n.node().querySelector("g"));return n.call(i),this._active||P.call(this,a),this._originalTransform=o.zoomTransform(n.node()),this}function E(t){var e=this._translation,n=this._scale,i=t.datum().translation,a=t.datum().scale,r=o.zoomTransform(this._zoomSelection.node());return e&&(r=(r=r.scale(1/n)).translate(-e.x,-e.y)),r=(r=r.translate(i.x,i.y)).scale(a)}function P(t){this._zoomBehavior.transform(this._zoomSelection,E.call(this,t)),this._translation=t.datum().translation,this._scale=t.datum().scale,this._originalTransform=o.zoomIdentity.translate(t.datum().translation.x,t.datum().translation.y).scale(t.datum().scale)}function z(t,e){return function(){var n=t.map((function(t){return r.interpolate([t[0][0],t[0][1]],[t[1][0],t[1][1]])}));return function(t){return t<1?"M"+n.map((function(e){return e(t)})).join("L"):e}}}function k(t){return"edge"==t.attributes.class||"a"==t.tag&&"g"==t.parent.tag&&"edge"==t.parent.parent.attributes.class}function S(t){return t.parent&&k(t.parent)}function N(t){var n=this._transition,i=this._options.fade&&null!=n,a=this._options.tweenPaths,s=this._options.tweenShapes,l=this._options.convertEqualSidedPolygons,h=this._options.growEnteringEdges&&null!=n,c=this._attributer,d=this;function f(t){var g=e.select(this);if("svg"==t.tag){var m=d._options;if(null!=m.width||null!=m.height){var y=m.width,_=m.height;null==y?y=4*t.attributes.width.replace("pt","")/3:(g.attr("width",y),t.attributes.width=y),null==_?_=4*t.attributes.height.replace("pt","")/3:(g.attr("height",_),t.attributes.height=_),m.fit||(g.attr("viewBox","0 0 ".concat(3*y/4/m.scale," ").concat(3*_/4/m.scale)),t.attributes.viewBox="0 0 ".concat(3*y/4/m.scale," ").concat(3*_/4/m.scale))}1!=m.scale&&(m.fit||null==m.width&&null==m.height)&&(y=t.attributes.viewBox.split(" ")[2],_=t.attributes.viewBox.split(" ")[3],g.attr("viewBox","0 0 ".concat(y/m.scale," ").concat(_/m.scale)),t.attributes.viewBox="0 0 ".concat(y/m.scale," ").concat(_/m.scale))}c&&g.each(c);var w=t.tag,x=t.attributes,b=g.node().attributes;if(b)for(var N=0;N<b.length;N++){var D=b[N],M=D.name;if("xmlns"!=M.split(":")[0]&&D.namespaceURI){var j=D.namespaceURI.split("/");M=j[j.length-1]+":"+M}M in x||(x[M]=null)}var W=!1,O=!1;if(s&&n){if("polygon"!=this.nodeName&&"ellipse"!=this.nodeName||!t.alternativeOld||(O=!0),"polygon"!=w&&"ellipse"!=w||!t.alternativeNew||(W=!0),"polygon"==this.nodeName&&"polygon"==w&&t.alternativeOld){var L=u(g).attributes.points;if(!l){var q=L.split(" ").length;(Y=t.attributes.points).split(" ").length==q&&(W=!1,O=!1)}}if(O){var A=t.alternativeOld,T=v(g,A);T.data([t],(function(){return t.key})),g=T}if(W)w="path",x=t.alternativeNew.attributes}var I=g;if(n&&(I=I.transition(n),i&&I.filter((function(t){return"#"==t.tag[0]?null:this})).style("opacity",1),I.filter((function(t){return"#"==t.tag[0]?null:this})).on("end",(function(){e.select(this).attr("style",null)}))),h&&"path"==w&&t.offset){var B=t.totalLength;g.attr("stroke-dasharray",B+" "+B).attr("stroke-dashoffset",B).attr("transform","translate("+t.offset.x+","+t.offset.y+")"),x["stroke-dashoffset"]=0,x.transform="translate(0,0)",I.attr("stroke-dashoffset",x["stroke-dashoffset"]).attr("transform",x.transform).on("start",(function(){e.select(this).style("opacity",null)})).on("end",(function(){e.select(this).attr("stroke-dashoffset",null).attr("stroke-dasharray",null).attr("transform",null)}))}if(h&&"polygon"==w&&S(t)&&t.offset&&"path"==t.parent.children[3].tag){var R=e.select(g.node().parentNode.querySelector("path")),U=R.node().getPointAtLength(0),F=R.node().getPointAtLength(t.totalLength),C=R.node().getPointAtLength(t.totalLength-1),Z=180*Math.atan2(F.y-C.y,F.x-C.x)/Math.PI,V=U.x-F.x+t.offset.x,G=U.y-F.y+t.offset.y;g.attr("transform","translate("+V+","+G+")"),I.attrTween("transform",(function(){return function(e){var n=R.node().getPointAtLength(t.totalLength*e),i=R.node().getPointAtLength(t.totalLength*e+1),a=180*Math.atan2(i.y-n.y,i.x-n.x)/Math.PI-Z;return V=n.x-F.x+t.offset.x*(1-e),G=n.y-F.y+t.offset.y*(1-e),"translate("+V+","+G+") rotate("+a+" "+F.x+" "+F.y+")"}})).on("start",(function(){e.select(this).style("opacity",null)})).on("end",(function(){e.select(this).attr("transform",null)}))}for(var H=a&&n&&"path"==w&&null!=g.attr("d"),J=0,K=Object.keys(x);J<K.length;J++){var Q=K[J],X=x[Q];if(H&&"d"==Q){var Y;(Y=(t.alternativeOld||t).points)&&I.attrTween("d",z(Y,X))}else{if("transform"==Q&&t.translation)if(n){var $=I.on("end");I.on("start",(function(){d._zoomBehavior&&I.tween("attr.transform",(function(){var t=this;return function(e){t.setAttribute("transform",r.interpolateTransformSvg(o.zoomTransform(d._zoomSelection.node()).toString(),E.call(d,g).toString())(e))}}))})).on("end",(function(){$.call(this),d._zoomBehavior&&P.call(d,g)}))}else d._zoomBehavior&&(X=E.call(d,g).toString());I.attr(Q,X)}}W&&I.on("end",(function(t,n,i){v(T=e.select(this),t).data([t],(function(){return t.key}))})),t.text&&I.text(t.text),function(t){var a=t.selectAll((function(){return t.node().childNodes})),r=(a=a.data((function(t){return t.children}),(function(t){return t.key}))).enter().append((function(t){var e=p(t);return"#text"==t.tag&&i&&(e.nodeValue=t.text),e}));(i||h&&k(t.datum()))&&r.filter((function(t){return"#"==t.tag[0]?null:this})).each((function(t){for(var n=e.select(this),i=0,a=Object.keys(t.attributes);i<a.length;i++){var r=a[i],o=t.attributes[r];n.attr(r,o)}})).filter((function(t){return"svg"==t.tag||"g"==t.tag?null:this})).style("opacity",0);var o=a.exit();c&&o.each(c),n&&(o=o.transition(n),i&&o.filter((function(t){return"#"==t.tag[0]?null:this})).style("opacity",0)),o=o.remove(),(a=r.merge(a)).each(f)}(g)}var g=this._selection;if(null!=n){var m=this._jobs;if(d._active)return m.push(null),this;g.transition(n).transition().duration(0).on("end",(function(){d._active=!1,0!=m.length&&(m.shift(),d.render())})),this._active=!0}null!=n&&g.transition(n).on("start",(function(){d._dispatch.call("transitionStart",d)})).on("end",(function(){d._dispatch.call("transitionEnd",d)})).transition().duration(0).on("start",(function(){d._dispatch.call("restoreEnd",d),d._dispatch.call("end",d),t&&t.call(d)}));var y=this._data,_=g.selectAll("svg").data([y],(function(t){return t.key}));return _=_.enter().append("svg").merge(_),f.call(_.node(),y),this._options.zoom&&!this._zoomBehavior&&b.call(this),d._dispatch.call("renderEnd",d),null==n&&(this._dispatch.call("end",this),t&&t.call(this)),this}function D(t,e){if("polygon"==t.tag){(d=w(t)).tag="path";var n=w(u=t.attributes),i=u.points;if("polygon"==e.tag){(m=t.bbox).cx=m.x+m.width/2,m.cy=m.y+m.height/2;for(var a=u.points.split(" "),r=a.map((function(t){var e=t.split(",");return[e[0]-m.cx,e[1]-m.cy]})),o=r[r.length-1][0],s=r[r.length-1][1],l=0;l<r.length;l++,o=k,s=S){var h=(k=r[l][0])-o;if(0!=(b=(S=r[l][1])-s))if(0<=(N=o-s*h/b)&&N<1/0&&(o<=N&&N<=k||k<=N&&N<=o))break}var c=[[m.cx+N,m.cy+0].join(",")];i=(c=(c=c.concat(a.slice(l))).concat(a.slice(0,l))).join(" ")}n.d="M"+i+"z",delete n.points,d.attributes=n}else{var d;(d=w(t)).tag="path";n=w(u=t.attributes);var u,f=u.cx,p=u.cy,g=u.rx,v=u.ry;if("polygon"==e.tag){var m;(m=e.bbox).cx=m.x+m.width/2,m.cy=m.y+m.height/2;var y=e.attributes.points.split(" ")[0].split(","),_=y[0],x=y[1],b=(h=_-m.cx,x-m.cy),E=Math.sqrt(Math.pow(h,2)+Math.pow(b,2)),P=h/E,z=-b/E}else P=1,z=0;var k,S,N;h=(N=g*-P)-(k=g*P),b=-v*-z-(S=-v*z);n.d="M "+f+" "+p+" m "+k+","+S+" a "+g+","+v+" 0 1,0 "+h+","+b+" a "+g+","+v+" 0 1,0 "+-h+","+-b+"z",delete n.cx,delete n.cy,delete n.rx,delete n.ry,d.attributes=n}return d}function M(){var t=this;try{s.graphviz.layout("","svg","dot").then((function(){s.graphvizSync().then((function(e){t.layoutSync=e.layout.bind(e),null==t._worker&&t._dispatch.call("initEnd",t),t._afterInit&&t._afterInit()}))}))}catch(t){}if(null!=this._worker){var e=this._vizURL,n=this;this._worker.onmessage=function(t){var e=n._workerCallbacks.shift();switch(t.data.type){case"init":n._dispatch.call("initEnd",this);break;case"done":return W.call(n,t.data.svg,e);case"error":if(!n._onerror)throw t.data.error;n._onerror(t.data.error)}},e.match(/^https?:\/\/|^\/\//i)||(e=new window.URL(e,document.location.href).href),j.call(this,{dot:"",engine:"dot",vizURL:e})}}function j(t,e){this._workerCallbacks.push(e),this._worker.postMessage(t)}function W(t,n){var i=this._options.keyMode,a=this._options.tweenPaths,r=this._options.tweenShapes;if("string"==typeof this._options.tweenPrecision&&this._options.tweenPrecision.includes("%"))var o=+this._options.tweenPrecision.split("%")[0]/100,s=this._options.tweenPrecision.includes("%");else o=this._options.tweenPrecision,s=!1;var l=this._options.growEnteringEdges,h={},c=this._dictionary||{},d={},u=this._nodeDictionary||{};function p(t,e){var n=t.tag;if("index"==i)t.key=e;else if("#"!=n[0])if("id"==i)t.key=t.attributes.id;else if("title"==i){var a=t.children.find((function(t){return"title"==t.tag}));a&&(a.children.length>0?t.key=a.children[0].text:t.key="")}null==t.key&&(r&&("ellipse"!=n&&"polygon"!=n||(n="path")),t.key=n+"-"+e)}function v(t,e){var n=(e?e.id+".":"")+t.key;t.id=n}function m(t){h[t.id]=t}function y(t,e){r&&t.id in c&&("polygon"!=e.tag&&"ellipse"!=e.tag&&"path"!=e.tag||e.tag==t.tag&&"polygon"!=t.tag||("path"!=e.tag&&(t.alternativeOld=D(e,t)),"path"!=t.tag&&(t.alternativeNew=D(t,e))))}function _(t,e){if(a&&e&&("path"==e.tag||t.alternativeOld&&"path"==t.alternativeOld.tag)){var n=(t.alternativeNew||t).attributes.d;if(t.alternativeOld)var i=g(t.alternativeOld);else i=g(e);(t.alternativeOld||(t.alternativeOld={})).points=function(t,e,n,i){for(var a=t,r=a.cloneNode(),o=a.getTotalLength(),s=(r.setAttribute("d",e),r).getTotalLength(),l=[0],h=0,c=i?n:n/Math.max(o,s);(h+=c)<1;)l.push(h);return l.push(1),l.map((function(t){var e=a.getPointAtLength(t*o),n=r.getPointAtLength(t*s);return[[e.x,e.y],[n.x,n.y]]}))}(i,n,o,s)}}function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;p(t,e),v(t,n);var i=t.id,a=c[i];m(t),y(t,a),_(t,a);var r={};t.children.forEach((function(e){var n=e.tag;"ellipse"!=n&&"polygon"!=n||(n="path"),null==r[n]&&(r[n]=0),w(e,r[n]++,t)}))}function x(t){!function(t){var e=t.tag;if(l&&t.parent&&"node"==t.parent.attributes.class&&"title"==e){if(t.children.length>0)var n=t.children[0].text;else n="";d[n]=t.parent}}(t),function(t){var e=t.id,n=t.tag,i=c[e];if(l&&!i&&t.parent&&S(t)&&("path"==n||"polygon"==n)){if("polygon"==n){var a=t.parent.children.find((function(t){return"path"==t.tag}));a&&(t.totalLength=a.totalLength)}var r=function(t){return function(t){return"edge"==t.parent.attributes.class?t.parent:t.parent.parent.parent}(t).children.find((function(t){return"title"==t.tag}))}(t).children[0],o=r.text.split("->");2!=o.length&&(o=r.text.split("--"));var s=o[0],h=d[s],f=u[s];if(f){if((v=h.children.findIndex((function(t,e){return"g"==t.tag})))>=0){var p=h.children[v].children.findIndex((function(t,e){return"a"==t.tag}));h=h.children[v].children[p]}if((v=f.children.findIndex((function(t,e){return"g"==t.tag})))>=0){p=f.children[v].children.findIndex((function(t,e){return"a"==t.tag}));f=f.children[v].children[p]}for(var g=h.children,v=0;v<g.length;v++)if("polygon"==g[v].tag||"ellipse"==g[v].tag||"path"==g[v].tag||"text"==g[v].tag){var m=g[v];break}var y=f.children;for(v=0;v<y.length;v++)if("polygon"==y[v].tag||"ellipse"==y[v].tag||"path"==y[v].tag||"text"==y[v].tag){var _=y[v];break}t.offset=_&&m?{x:_.center.x-m.center.x,y:_.center.y-m.center.y}:{x:0,y:0}}}}(t),t.children.forEach((function(t){x(t)}))}this._dispatch.call("layoutEnd",this);var b=e.select(document.createDocumentFragment()).append("div"),E=(new window.DOMParser).parseFromString(t,"image/svg+xml");b.append((function(){return E.documentElement}));var P=f(b.select("svg"));(this._dispatch.call("dataExtractEnd",this),w(P),this._dispatch.call("dataProcessPass1End",this),x(P),this._dispatch.call("dataProcessPass2End",this),this._data=P,this._dictionary=h,this._nodeDictionary=d,this._extractData=function(t,e,n){var i=f(t);return w(i,e,n),x(i),i},this._busy=!1,this._dispatch.call("dataProcessEnd",this),n&&n.call(this),this._queue.length>0)&&this._queue.shift().call(this)}function O(t,e,n,i){var a=[t*n-(e=-e)*(i=-i),t*i+e*n];return[t=a[0],e=-(e=a[1])]}function L(t,e,n,i,a,r,o){var s=f(I.call(this,r));t.data([s]),_.call(t.node(),s),q(t,e,n,i,a,r,o)}function q(t,e,n,i,a,r,o){var s=o.shortening||0,l=[[0,-3.5],[10,0],[0,3.5],[0,-3.5]],c=i-e,d=a-n,u=Math.sqrt(c*c+d*d);if(0==u)var f=1,p=0;else f=c/u,p=d/u;if(i=e+(u-s-10-.1)*f,a=n+(u-s-10-.1)*p,r.URL||r.tooltip)var g=t.selectWithoutDataPropagation("g").selectWithoutDataPropagation("a"),v=g.selectWithoutDataPropagation("path"),m=g.selectWithoutDataPropagation("polygon");else v=t.selectWithoutDataPropagation("path"),m=t.selectWithoutDataPropagation("polygon");var y=h.path();y.moveTo(e,n),y.lineTo(i,a),v.attr("d",y),i=e+(u-s-10)*f,a=n+(u-s-10)*p;for(var _=0;_<l.length;_++){var w=l[_];l[_]=O(w[0],w[1],f,p)}for(_=0;_<l.length;_++){w=l[_];l[_]=[i+w[0],a+w[1]]}var x=[];for(_=0;_<l.length;_++){w=l[_];x.push(w.join(","))}var b=x.join(" ");return m.attr("points",b),this}function A(){return this._drawnEdge?(this._drawnEdge.g.remove(),this._drawnEdge=null,this):this}function T(){return this._drawnEdge?this._drawnEdge.g:e.select(null)}function I(t){for(var n="",i=0,a=Object.keys(t);i<a.length;i++){var r=a[i];null!=t[r]&&(n+=' "'+r+'"="'+t[r]+'"')}var o="digraph {a -> b ["+n+"]}",s=this.layoutSync(o,"svg","dot"),l=(new window.DOMParser).parseFromString(s,"image/svg+xml");return e.select(document.createDocumentFragment()).append((function(){return l.documentElement})).select(".edge")}function B(t,e,n,i,a,r){var o=f(C.call(this,i,a));return t.data([o]),_.call(t.node(),o),R(t,e,n,a),this}function R(t,n,i,a,r){if(a.URL||a.tooltip)var o=t.selectWithoutDataPropagation("g").selectWithoutDataPropagation("a");else o=t;var s=o.selectAll("ellipse,polygon,path,polyline"),l=t.selectWithoutDataPropagation("text");if(0!=s.size()){var h=s.node().getBBox();h.cx=h.x+h.width/2,h.cy=h.y+h.height/2}else 0!=l.size()&&(h={x:+l.attr("x"),y:+l.attr("y"),width:0,height:0,cx:+l.attr("x"),cy:+l.attr("y")});return s.each((function(t,a){var r=e.select(this);if(r.attr("cx"))r.attr("cx",x(n)).attr("cy",x(i));else if(r.attr("points")){var o=r.attr("points").trim();r.attr("points",function(t,e,n){var i,a=(i=t.split(" ")).map((function(t){return t.split(",")}));return a=i.map((function(t){return[x(+e+ +t.split(",")[0]),x(+n+ +t.split(",")[1])]})),t=(i=a.map((function(t){return t.join(",")}))).join(" ")}(o,n-h.cx,i-h.cy))}else{var s=r.attr("d");r.attr("d",function(t,e,n){(a=t.split(/[A-Z ]/)).shift();var i=t.split(/[^[A-Z ]+/),a=(a.map((function(t){return t.split(",")})),a.map((function(t){return[x(+e+ +t.split(",")[0]),x(+n+ +t.split(",")[1])]})).map((function(t){return t.join(",")})));return t=i.reduce((function(t,e,n){return t.concat(e,a[n])}),[]).join("")}(s,n-h.cx,i-h.cy))}})),0!=l.size()&&l.attr("x",x(+l.attr("x")+n-h.cx)).attr("y",x(+l.attr("y")+i-h.cy)),this}function U(){if(!this._drawnNode)return this;var t=this._drawnNode.g;return t.empty()||t.remove(),this._drawnNode=null,this}function F(){return this._drawnNode?this._drawnNode.g:e.select(null)}function C(t,n){for(var i="",a=0,r=Object.keys(n);a<r.length;a++){var o=r[a];null!=n[o]&&(i+=' "'+o+'"="'+n[o]+'"')}var s='graph {"'+t+'" ['+i+"]}",l=this.layoutSync(s,"svg","dot"),h=(new window.DOMParser).parseFromString(l,"image/svg+xml");return e.select(document.createDocumentFragment()).append((function(){return h.documentElement})).select(".node")}function Z(){var t;self.document={},self.onmessage=function(e){e.data.vizURL&&(importScripts(e.data.vizURL),(t=self["@hpcc-js/wasm"]).wasmFolder(e.data.vizURL.match(/.*\//))),t.graphviz.layout(e.data.dot,"svg",e.data.engine,e.data.options).then((function(t){t?self.postMessage({type:"done",svg:t}):e.data.vizURL?self.postMessage({type:"init"}):self.postMessage({type:"skip"})})).catch((function(t){self.postMessage({type:"error",error:t.message})}))}}var V;function G(t,i){if(this._options={useWorker:!0,engine:"dot",keyMode:"title",fade:!0,tweenPaths:!0,tweenShapes:!0,convertEqualSidedPolygons:!0,tweenPrecision:1,growEnteringEdges:!0,zoom:!0,zoomScaleExtent:[.1,10],zoomTranslateExtent:[[-1/0,-1/0],[1/0,1/0]],width:null,height:null,scale:1,fit:!1},i instanceof Object)for(var a=0,r=Object.keys(i);a<r.length;a++){var o=r[a];this._options[o]=i[o]}else"boolean"==typeof i&&(this._options.useWorker=i);var s=this._options.useWorker;if("undefined"==typeof Worker&&(s=!1),s){var l=e.selectAll("script").filter((function(){return"javascript/worker"==e.select(this).attr("type")||e.select(this).attr("src")&&e.select(this).attr("src").match(/.*\/@hpcc-js\/wasm/)}));0==l.size()?(console.warn('No script tag of type "javascript/worker" was found and "useWorker" is true. Not using web worker.'),s=!1):(this._vizURL=l.attr("src"),this._vizURL||(console.warn('No "src" attribute of was found on the "javascript/worker" script tag and "useWorker" is true. Not using web worker.'),s=!1))}if(s){var h=new Blob(["("+Z.toString()+")()"]),c=window.URL.createObjectURL(h);this._worker=new Worker(c),this._workerCallbacks=[]}this._selection=t,this._active=!1,this._busy=!1,this._jobs=[],this._queue=[],this._keyModes=new Set(["title","id","tag-index","index"]),this._images=[],this._translation=void 0,this._scale=void 0,this._eventTypes=["initEnd","start","layoutStart","layoutEnd","dataExtractEnd","dataProcessPass1End","dataProcessPass2End","dataProcessEnd","renderStart","renderEnd","transitionStart","transitionEnd","restoreEnd","end"],this._dispatch=n.dispatch.apply(void 0,d(this._eventTypes)),M.call(this),t.node().__graphviz__=this}function H(t,n){return e.select(t).graphviz(n)}function J(){var t="/tmp/d3-graphviz-npm/d3-graphviz/index.js",e=new Function("return this")(),n="__coverage__",i=e[n]||(e[n]={});i[t]&&"8918f1e98fa5848854500c53da95bee86581bfda"===i[t].hash||(i[t]={path:"/tmp/d3-graphviz-npm/d3-graphviz/index.js",statementMap:{},fnMap:{},branchMap:{},s:{},f:{},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8918f1e98fa5848854500c53da95bee86581bfda"});var a=i[t];return J=function(){return a},a}G.prototype=H.prototype=(c(V={constructor:G,engine:function(t){return this._options.engine=t,this},addImage:function(t,e,n){return this._images.push({path:t,width:e,height:n}),this},keyMode:function(t){if(!this._keyModes.has(t))throw Error("Illegal keyMode: "+t);if(t!=this._options.keyMode&&null!=this._data)throw Error("Too late to change keyMode");return this._options.keyMode=t,this},fade:function(t){return this._options.fade=t,this},tweenPaths:function(t){return this._options.tweenPaths=t,this},tweenShapes:function(t){return this._options.tweenShapes=t,t&&(this._options.tweenPaths=!0),this},convertEqualSidedPolygons:function(t){return this._options.convertEqualSidedPolygons=t,this},tweenPrecision:function(t){return this._options.tweenPrecision=t,this},growEnteringEdges:function(t){return this._options.growEnteringEdges=t,this},zoom:function(t){return this._options.zoom=t,this._options.zoom&&!this._zoomBehavior&&b.call(this),this},resetZoom:function(t){var e=this._zoomSelection;return t&&(e=e.transition(t)),e.call(this._zoomBehavior.transform,this._originalTransform),this},zoomBehavior:function(){return this._zoomBehavior||null},zoomSelection:function(){return this._zoomSelection||null},zoomScaleExtent:function(t){return this._options.zoomScaleExtent=t,this},zoomTranslateExtent:function(t){return this._options.zoomTranslateExtent=t,this},render:function(t){return this._busy?(this._queue.push(this.render.bind(this,t)),this):(this._dispatch.call("renderStart",this),this._transitionFactory?a.timeout(function(){this._transition=i.transition(this._transitionFactory()),N.call(this,t)}.bind(this),0):N.call(this,t),this)},dot:function(t,e){this._worker;var n=this._options.engine,i=this._images;this._dispatch.call("start",this),this._busy=!0,this._dispatch.call("layoutStart",this);var a={images:i};if(this._worker)j.call(this,{dot:t,engine:n,options:a},e);else{if(null==this.layoutSync)return this._afterInit=this.dot.bind(this,t,e),this;try{var r=this.layoutSync(t,"svg",n,a)}catch(t){if(this._onerror)return this._onerror(t.message),this;throw t.message}W.call(this,r,e)}return this},data:function(){return this._data||null},renderDot:function(t,e){var n=this;return this.dot(t,(function(){n.render(e)})),this},transition:function(t){return t instanceof Function?this._transitionFactory=t:this._transition=i.transition(t),this},active:function(t){var e=this._selection.selectWithoutDataPropagation("svg");return 0!=e.size()?i.active(e.node(),t):null},options:function(t){if(void 0===t)return Object.assign({},this._options);for(var e=0,n=Object.keys(t);e<n.length;e++){var i=n[e];this._options[i]=t[i]}return this},width:function(t){return this._options.width=t,this},height:function(t){return this._options.height=t,this},scale:function(t){return this._options.scale=t,this},fit:function(t){return this._options.fit=t,this},attributer:function(t){return this._attributer=t,this},on:function(t,e){return this._dispatch.on(t,e),this},onerror:function(t){return this._onerror=t,this},logEvents:function(t){var e=this,n=Date.now(),i={},a=this._eventTypes,r=Math.max.apply(Math,d(a.map((function(t){return t.length})))),o=function(o){var s=a[o];i[s]=[],h=e,e.on(s+".log",t?function(){var t=Date.now(),e=i[s].length;i[s].push(t);var a="";if(a+="Event ",a+=l.format(" >2")(o)+" ",a+=s+" ".repeat(r-s.length),a+=l.format(" >5")(t-n)+" ","initEnd"!=s&&(a+=l.format(" >5")(t-i.start[e])),"dataProcessEnd"==s&&(a+=" prepare                 "+l.format(" >5")(t-i.layoutEnd[e])),"renderEnd"==s&&h._transition&&(a+=" transition start margin "+l.format(" >5")(h._transition.delay()-(t-i.renderStart[e])),c=h._transition.delay(),u=h._transition.duration()),"transitionStart"==s){var d=t-i.renderStart[e];a+=" transition delay        "+l.format(" >5")(t-i.renderStart[e]),a+=" expected "+l.format(" >5")(c),a+=" diff "+l.format(" >5")(d-c)}if("transitionEnd"==s){var f=t-i.transitionStart[e];a+=" transition duration     "+l.format(" >5")(f),a+=" expected "+l.format(" >5")(u),a+=" diff "+l.format(" >5")(f-u)}console.log(a),n=t}:null)};for(var s in a){var h,c,u;o(s)}return this},drawEdge:function(t,n,i,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if((r=Object.assign({},r)).style&&r.style.includes("invis"))var s=e.select(null);else{var l=this._selection,h=l.selectWithoutDataPropagation("svg"),c=h.selectWithoutDataPropagation("g"),d=I.call(this,r),u=f(d);s=c.append("g").data([u]);_.call(s.node(),u),L.call(this,s,t,n,i,a,r,o)}return this._drawnEdge={g:s,x1:t,y1:n,x2:i,y2:a,attributes:r},this},updateDrawnEdge:function(t,e,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(!this._drawnEdge)throw Error("No edge has been drawn");var o=this._drawnEdge.g;if(a=Object.assign(this._drawnEdge.attributes,a),this._drawnEdge.x1=t,this._drawnEdge.y1=e,this._drawnEdge.x2=n,this._drawnEdge.y2=i,o.empty()&&(!a.style||!a.style.includes("invis"))){var s=this._selection,l=s.selectWithoutDataPropagation("svg"),h=l.selectWithoutDataPropagation("g");o=h.append("g");this._drawnEdge.g=o}return o.empty()||L.call(this,o,t,e,n,i,a,r),this},moveDrawnEdgeEndPoint:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._drawnEdge)throw Error("No edge has been drawn");var i=this._drawnEdge.g,a=this._drawnEdge.x1,r=this._drawnEdge.y1,o=this._drawnEdge.attributes;return this._drawnEdge.x2=t,this._drawnEdge.y2=e,q(i,a,r,t,e,o,n),this},insertDrawnEdge:function(t){if(!this._drawnEdge)throw Error("No edge has been drawn");var e=this._drawnEdge.g;if(e.empty())return this;this._drawnEdge.attributes,e.selectWithoutDataPropagation("title").text(t);var n=this._selection.selectWithoutDataPropagation("svg").selectWithoutDataPropagation("g"),i=n.datum(),a=this._extractData(e,i.children.length,n.datum());return i.children.push(a),m(e,a),this._drawnEdge=null,this},removeDrawnEdge:A},"removeDrawnEdge",A),c(V,"drawnEdgeSelection",T),c(V,"drawnEdgeSelection",T),c(V,"drawNode",(function(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if((a=Object.assign({},a)).style&&a.style.includes("invis"))var o=e.select(null);else{var s=this._selection,l=s.selectWithoutDataPropagation("svg"),h=l.selectWithoutDataPropagation("g"),c=C.call(this,i,a),d=f(c);o=h.append("g").data([d]);_.call(o.node(),d),B.call(this,o,t,n,i,a,r)}return this._drawnNode={g:o,nodeId:i,x:t,y:n,attributes:a},this})),c(V,"updateDrawnNode",(function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!this._drawnNode)throw Error("No node has been drawn");var r=this._drawnNode.g;if(null==n&&(n=this._drawnNode.nodeId),i=Object.assign(this._drawnNode.attributes,i),this._drawnNode.nodeId=n,this._drawnNode.x=t,this._drawnNode.y=e,r.empty()&&(!i.style||!i.style.includes("invis"))){var o=this._selection,s=o.selectWithoutDataPropagation("svg"),l=s.selectWithoutDataPropagation("g");r=l.append("g");this._drawnNode.g=r}return r.empty()||B.call(this,r,t,e,n,i,a),this})),c(V,"moveDrawnNode",(function(t,e){if(!this._drawnNode)throw Error("No node has been drawn");var n=this._drawnNode.g,i=this._drawnNode.attributes;return this._drawnNode.x=t,this._drawnNode.y=e,n.empty()||R(n,t,e,i),this})),c(V,"insertDrawnNode",(function(t){if(!this._drawnNode)throw Error("No node has been drawn");null==t&&(t=this._drawnNode.nodeId);var e=this._drawnNode.g;if(e.empty())return this;var n=this._drawnNode.attributes;if(e.selectWithoutDataPropagation("title").text(t),n.URL||n.tooltip)var i=e.selectWithoutDataPropagation("g").selectWithoutDataPropagation("a"),a=(i.selectWithoutDataPropagation("ellipse,polygon,path,polyline"),i.selectWithoutDataPropagation("text"));else e.selectWithoutDataPropagation("ellipse,polygon,path,polyline"),a=e.selectWithoutDataPropagation("text");a.text(n.label||t);var r=this._selection.selectWithoutDataPropagation("svg").selectWithoutDataPropagation("g"),o=r.datum(),s=this._extractData(e,o.children.length,r.datum());return o.children.push(s),m(e,s),this._drawnNode=null,this})),c(V,"removeDrawnNode",U),c(V,"removeDrawnNode",U),c(V,"drawnNodeSelection",F),c(V,"drawnNodeSelection",F),V),e.selection.prototype.graphviz=function(t){var e=this.node().__graphviz__;return e?(e.options(t),a.timeout(function(){e._dispatch.call("initEnd",this)}.bind(this),0)):e=new G(this,t),e},e.selection.prototype.selectWithoutDataPropagation=function(t){return e.select(this.size()>0?this.node().querySelector(t):null)},J(),t.graphviz=H,Object.defineProperty(t,"__esModule",{value:!0})}));